<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.2.- Inicio y fin de una sesión. | Tema 3 </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="NONAME" />
<meta name="generator" content="eXeLearning 2.4.2 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" /></head>
<body class="exe-web-site" id="exe-node-8"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">Tema 3</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Desarrollo de aplicaciones web con PHP.</a></li>
   <li><a href="1_autentificacin_de_usuarios_y_control_de_acceso.html" class="daddy">1.- Autentificación de usuarios y control de acceso.</a>
   <ul class="other-section">
      <li><a href="11_mecanismos_de_autentificacin_i.html" class="daddy">1.1.- Mecanismos de autentificación (I).</a>
      <ul class="other-section">
         <li><a href="111_mecanismos_de_autentificacin_ii.html" class="no-ch">1.1.1.- Mecanismos de autentificación (II).</a></li>
      </ul>
      </li>
      <li><a href="12_incorporacin_de_mtodos_de_autentificacin_a_una_aplicacin_web.html" class="no-ch">1.2.- Incorporación de métodos de autentificación a una aplicación web.</a></li>
   </ul>
   </li>
   <li><a href="2_cookies.html" class="no-ch">2.- Cookies.</a></li>
   <li class="current-page-parent"><a href="3_manejo_de_sesiones.html" class="current-page-parent daddy">3.- Manejo de sesiones.</a>
   <ul>
      <li><a href="31_configuracin.html" class="no-ch">3.1.- Configuración.</a></li>
      <li id="active"><a href="32_inicio_y_fin_de_una_sesin.html" class="active no-ch">3.2.- Inicio y fin de una sesión.</a></li>
      <li><a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="daddy">3.3.- Gestión de la información de la sesión (I).</a>
      <ul class="other-section">
         <li><a href="331_gestin_de_la_informacin_de_la_sesin_ii.html" class="no-ch">3.3.1.- Gestión de la información de la sesión (II).</a></li>
         <li><a href="332_gestin_de_la_informacin_de_la_sesin_iii.html" class="no-ch">3.3.2.- Gestión de la información de la sesión (III).</a></li>
         <li><a href="333_gestin_de_la_informacin_de_la_sesin_iv.html" class="no-ch">3.3.3.- Gestión de la información de la sesión (IV).</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="4_herramientas_para_depuracin_de_cdigo.html" class="daddy">4.- Herramientas para depuración de código.</a>
   <ul class="other-section">
      <li><a href="41_instalacin_de_herramientas_de_depuracin.html" class="no-ch">4.1.- Instalación de herramientas de depuración.</a></li>
      <li><a href="42_depuracin_de_cdigo_en_php.html" class="no-ch">4.2.- Depuración de código en PHP.</a></li>
   </ul>
   </li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="31_configuracin.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">3.2.- Inicio y fin de una sesión.</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id32">
<div class="iDevice emphasis0">
<div id="ta32_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado"><img src="DWES04_CONT_R07_Tiempo.jpg" alt="Im&aacute;genes superpuestas de varios relojes." title="Tiempo." height="192" width="152" /></div>
<div class="elemento_centrado credenciales"><a class="cc0" title="Dominio p&uacute;blico" href="http://creativecommons.org/publicdomain/zero/1.0/deed.es" target="_blank"><span class="transparente">Dominio p&uacute;blico</span></a>&nbsp;Stockbyte.CD-DVD Num. EP006.</div>
</div>
<p>El inicio de una sesi&oacute;n puede tener lugar de dos formas. Si has activado la directiva <code>session.auto_start</code> en la configuraci&oacute;n de <span lang="en">PHP</span>, la sesi&oacute;n comenzar&aacute; autom&aacute;ticamente en cuanto un usuario se conecte a tu sitio <span lang="en">web</span>. En caso de que ese usuario ya haya abierto una sesi&oacute;n con anterioridad, y esta no se haya eliminado, en lugar de abrir una nueva sesi&oacute;n se reanudar&aacute; la anterior. Para ello se utilizar&aacute; el <span lang="en">SID</span> anterior, que estar&aacute; almacenado en una <span lang="en">cookie</span> (recuerda que si usas propagaci&oacute;n del <span lang="en">SID</span>, no podr&aacute;s restaurar sesiones anteriores; el <span lang="en">SID</span> figura en la <span lang="en">URL</span> y se pierde cuando cierras el navegador).</p>
<p>Si por el contrario, decides no utilizar el inicio autom&aacute;tico de sesiones, deber&aacute;s ejecutar la funci&oacute;n <code>session_start</code> para indicar a <span lang="en">PHP</span> que inicie una nueva sesi&oacute;n o reanude la anterior. Aunque anteriormente esta funci&oacute;n devolv&iacute;a siempre <code>true</code>, a partir de la versi&oacute;n 5.3.0 de <span lang="en">PHP</span> su comportamiento es m&aacute;s coherente: devuelve <code>false</code> en caso de no poder iniciar o restaurar la sesi&oacute;n.</p>
</div>
</div>
</article>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id33">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta33_70" class="block iDevice_content">
<p>Como el inicio de sesi&oacute;n requiere utilizar <span lang="en">cookies</span>, y &eacute;stas se transmiten en los encabezados <span lang="en">HTTP</span>, debes tener en cuenta que para poder iniciar una sesi&oacute;n utilizando <code>session_start</code>, tendr&aacute;s que hacer las llamadas a esta funci&oacute;n antes de que la p&aacute;gina <span lang="en">web</span> muestre informaci&oacute;n en el navegador.</p>
<p>Adem&aacute;s, todas las p&aacute;ginas que necesiten utilizar la informaci&oacute;n almacenada en la sesi&oacute;n, deber&aacute;n ejecutar la funci&oacute;n <code>session_start</code>.</p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id34">
<div class="iDevice emphasis0">
<div id="ta34_73" class="block iDevice_content">
<p>Mientras la sesión permanece abierta, puedes utilizar la variable superglobal <code>$_SESSION</code> para añadir información a la sesión del usuario, o para acceder a la información almacenada en la sesión. Por ejemplo, para contar el número de veces que el usuario visita la página, puedes hacer:</p>
<div class="codigo elemento_centrado" style="width: 41.75em;">
<div class="texto_izquierda">
<pre><code>&lt;?php</code></pre>
<pre><code>// Iniciamos la sesión o recuperamos la anterior sesión existente</code></pre>
<pre><code>session_start();</code></pre>
<pre><code>// Comprobamos si la variable ya existe</code></pre>
<pre><code>if (isset($_SESSION['visitas']))</code></pre>
<pre><code>$_SESSION['visitas']++;</code></pre>
<pre><code>else</code></pre>
<pre><code>$_SESSION['visitas'] = 0;</code></pre>
<pre><code>?&gt;  </code></pre>
</div>
</div>
<p>Si en lugar del número de visitas, quisieras almacenar el instante en que se produce cada una, la variable de sesión "visitas" deberá ser un array y por tanto tendrás que cambiar el código anterior por:</p>
<div class="codigo elemento_centrado" style="width: 41.75em;">
<div class="texto_izquierda">
<pre><code>&lt;?php</code></pre>
<pre><code>// Iniciamos la sesión o recuperamos la anterior sesión existente</code></pre>
<pre><code>session_start();</code></pre>
<pre><code>// En cada visita añadimos un valor al array "visitas"</code></pre>
<pre><code>$_SESSION['visitas'][] = time();</code></pre>
<pre><code>?&gt;  </code></pre>
</div>
</div>
<p></p>
<p>Es importante que tengas en cuenta que esta información se mantendrá solamente durante el tiempo de vida configurado para la sesión (por defecto 24 minutos como ya vimos) o hasta que cerremos el navegador. Tampoco se puede mantener la información si un usuario entra desde otro navegador u otro PC. Es decir que no sirve para llevar un log de visitas permanente.</p>
<p>También es importante que tengas en cuenta que tendrás que refrescar la página manualmente (pulsando F5) para ver cómo aumenta el contador de visitas.</p>
<h3>Eliminación de forma manual de la sesión</h3>
<p>Aunque como ya viste, puedes configurar <span lang="en">PHP</span> para que elimine de forma automática los datos de una sesión pasado cierto tiempo, en ocasiones puede ser necesario cerrarla de forma manual en un momento determinado. Por ejemplo, si utilizas sesiones para recordar la información de autentificación, deberás darle al usuario del sitio <span lang="en">web</span> la posibilidad de cerrar la sesión cuando lo crea conveniente.</p>
<p>En <span lang="en">PHP</span> tienes dos funciones para eliminar la información almacenada en la sesión:</p>
<ul class="lista_verificacion">
<li><code>session_unset</code>. Elimina las variables almacenadas en la sesión actual, pero no elimina la información de la sesión del dispositivo de almacenamiento usado.</li>
<li><code>session_destroy</code>. Elimina completamente la información de la sesión del dispositivo de almacenamiento.</li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id35">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header" style="background-image:url(icon_ejercicioresueltofpd.png)"><h1 class="iDeviceTitle">Ejercicio resuelto</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta35_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b35" class="block iDevice_content">
<p>
Crea una página similar a la anterior, almacenando en la sesión de usuario los instantes de todas sus últimas visitas. Si es su primera visita, muestra un mensaje de bienvenida. En caso contrario, muestra la fecha y hora de todas sus visitas anteriores. Añade un botón a la página que permita borrar el registro de visitas.
</p>
<p>
Utiliza también una variable de sesión para comprobar si el usuario se ha autentificado correctamente. De esta forma no hará falta comprobar las credenciales con la base de datos constantemente.
</p>

</section>
<form name="feedback-form-quesFeedback0b35" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b35text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b35" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b35" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<p>
Revisa la solución propuesta. Acuérdate de que debes hacer una llamada a la función <code>session_start()</code> antes de utilizar la variable superglobal <code>$_SESSION</code> para acceder a la información de la sesión.
</p>
<div class="enlace_centrado">
<a class="pdf" href="DWES04_CONT_R07b_Solucion_ejercicio.pdf" title="Descargar la solución al ejercicio de almacenamiento de información en la sesión del usuario. [pdf - 10.00 KB]">Solución propuesta.</a> <span class="tamano"> (10.00 KB) </span> 
</div>
</section>
</form>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id36">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h1 class="iDeviceTitle">Autoevaluación</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-36_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion36_60" class="block question iDevice_content">
<p><strong>Si usamos el inicio de sesi&oacute;n autom&aacute;tico, la sesi&oacute;n de un usuario se inicia en cuanto se autentifica correctamente en el servidor <span lang="en">web</span>.</strong></p>
</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i36_63" class="sr-av"><a href="#answer-36_63">Opción 1</a></label><input type="radio" name="option36_60" id="i36_63" class="exe-radio-option exe-radio-option-0-2-36_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-36_63"><div id="taans36_63" class="block iDevice_content">
<p>Falso.</p>
</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i36_108" class="sr-av"><a href="#answer-36_108">Opción 2</a></label><input type="radio" name="option36_60" id="i36_108" class="exe-radio-option exe-radio-option-1-2-36_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-36_108"><div id="taans36_108" class="block iDevice_content">
<p>Verdadero.</p>
</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b36_60" class="feedback js-hidden">
<div id="taf36_63" class=" iDevice_content">
<p>&iexcl;Correcto! Con el inicio de sesi&oacute;n autom&aacute;tico, la sesi&oacute;n del usuario se inicia en cuanto se conecta al sitio <span lang="en">web</span>, est&eacute; o no autentificado. No tiene nada que ver una cosa con otra. Un usuario no autentificado puede tener una sesi&oacute;n de la misma forma que otro que s&iacute; se haya autentificado correctamente.</p>
</div>
</section>
<section id="sa1b36_60" class="feedback js-hidden">
<div id="taf36_108" class=" iDevice_content">
<p>Incorrecto. Y si un sitio <span lang="en">web</span> no requiere que sus usuario se autentifiquen (es de libre acceso), &iquest;no puede usar sesiones?</p>
</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-36_63">Opción correcta</a><span> (<a href="#sa0b36_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-36_108">Incorrecto</a><span> (<a href="#sa1b36_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="31_configuracin.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_fpd_js.js"></script></body></html>