<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.3.1.- Gestión de la información de la sesión (II). | Tema 3 </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="NONAME" />
<meta name="generator" content="eXeLearning 2.4.2 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" /></head>
<body class="exe-web-site" id="exe-node-10"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">Tema 3</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Desarrollo de aplicaciones web con PHP.</a></li>
   <li><a href="1_autentificacin_de_usuarios_y_control_de_acceso.html" class="daddy">1.- Autentificación de usuarios y control de acceso.</a>
   <ul class="other-section">
      <li><a href="11_mecanismos_de_autentificacin_i.html" class="daddy">1.1.- Mecanismos de autentificación (I).</a>
      <ul class="other-section">
         <li><a href="111_mecanismos_de_autentificacin_ii.html" class="no-ch">1.1.1.- Mecanismos de autentificación (II).</a></li>
      </ul>
      </li>
      <li><a href="12_incorporacin_de_mtodos_de_autentificacin_a_una_aplicacin_web.html" class="no-ch">1.2.- Incorporación de métodos de autentificación a una aplicación web.</a></li>
   </ul>
   </li>
   <li><a href="2_cookies.html" class="no-ch">2.- Cookies.</a></li>
   <li class="current-page-parent"><a href="3_manejo_de_sesiones.html" class="current-page-parent daddy">3.- Manejo de sesiones.</a>
   <ul>
      <li><a href="31_configuracin.html" class="no-ch">3.1.- Configuración.</a></li>
      <li><a href="32_inicio_y_fin_de_una_sesin.html" class="no-ch">3.2.- Inicio y fin de una sesión.</a></li>
      <li class="current-page-parent"><a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="current-page-parent daddy">3.3.- Gestión de la información de la sesión (I).</a>
      <ul>
         <li id="active"><a href="331_gestin_de_la_informacin_de_la_sesin_ii.html" class="active no-ch">3.3.1.- Gestión de la información de la sesión (II).</a></li>
         <li><a href="332_gestin_de_la_informacin_de_la_sesin_iii.html" class="no-ch">3.3.2.- Gestión de la información de la sesión (III).</a></li>
         <li><a href="333_gestin_de_la_informacin_de_la_sesin_iv.html" class="no-ch">3.3.3.- Gestión de la información de la sesión (IV).</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="4_herramientas_para_depuracin_de_cdigo.html" class="daddy">4.- Herramientas para depuración de código.</a>
   <ul class="other-section">
      <li><a href="41_instalacin_de_herramientas_de_depuracin.html" class="no-ch">4.1.- Instalación de herramientas de depuración.</a></li>
      <li><a href="42_depuracin_de_cdigo_en_php.html" class="no-ch">4.2.- Depuración de código en PHP.</a></li>
   </ul>
   </li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="332_gestin_de_la_informacin_de_la_sesin_iii.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">3.3.1.- Gestión de la información de la sesión (II).</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id42">
<div class="iDevice emphasis0">
<div id="ta42_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado">
<div class="elemento_derecha">
<div class="elemento_centrado"><a title="Login." href="DWES04_CONT_R09_login.JPG" target="_blank"><img src="DWES04_CONT_R09_login_miniatura.jpg" alt="Captura de la p&aacute;gina web de autentificaci&oacute;n de los usuarios. Se muestras dos cuadros de texto para introducir respectivamente el nombre y la contrase&ntilde;a, y un bot&oacute;n para enviar el formulario." title="Login." class="imagen_ampliable" height="144" width="200" /></a></div>
<div class="elemento_centrado credenciales"><a class="cc0" title="Dominio p&uacute;blico" href="http://creativecommons.org/publicdomain/zero/1.0/deed.es" target="_blank"><span class="transparente">Dominio p&uacute;blico</span></a>&nbsp;Elaboraci&oacute;n Propia</div>
</div>
</div>
</div>
<p>La primera p&aacute;gina que vas a programar es la de autentificaci&oacute;n del usuario (<strong>login.php</strong>). Para variar, utilizar&aacute;s las capacidades de manejo de sesiones de <span lang="en">PHP</span> para almacenar la identificaci&oacute;n de los usuarios. Adem&aacute;s, utilizaremos la informaci&oacute;n de la tabla "usuarios" en la base de datos "dwes", accediendo mediante <acronym title="PHP Data Objects. PHP Datos Objeto." lang="en">PDO</acronym> en lugar de <span lang="en">MySQLi</span>.</p>
<p>Vas a crear en la p&aacute;gina un formulario con dos campos, uno de tipo text para el usuario, y otro de tipo password para la contrase&ntilde;a. Al pulsar el bot&oacute;n Enviar, el formulario se enviar&aacute; a esta misma p&aacute;gina, donde se comparar&aacute;n las credenciales proporcionadas por el usuario con las almacenadas en la base de datos. Si los datos son correctos, se iniciar&aacute; una nueva sesi&oacute;n y se almacenar&aacute; en ella el nombre del usuario que se acaba de conectar.</p>
<p>Vamos por pasos. El c&oacute;digo <acronym title="HyperText Markup Language." lang="en">HTML</acronym> para crear el formulario, que ir&aacute; dentro del cuerpo de la p&aacute;gina (entre las etiquetas <code>&lt; body&gt;</code>) ser&aacute; el siguiente:</p>
<div class="codigo elemento_centrado" style="width: 54.95em;">
<div class="texto_izquierda">
<pre><code>&lt;div id='login'&gt;</code>
</pre>
<pre><code>&lt;form action='login.php' method='post'&gt;</code>
</pre>
<pre><code>&lt;fieldset &gt;</code>
</pre>
<pre><code>    &lt;legend&gt;Login&lt;/legend&gt;</code>
</pre>
<pre><code>    &lt;div&gt;&lt;span class='error'&gt;&lt;?php echo $error; ?&gt;&lt;/span&gt;&lt;/div&gt;</code>
</pre>
<pre><code>    &lt;div class='campo'&gt;</code>
</pre>
<pre><code>        &lt;label for='usuario' &gt;Usuario:&lt;/label&gt;&lt;br/&gt;</code>
</pre>
<pre><code>        &lt;input type='text' name='usuario' id='usuario' maxlength="50" /&gt;&lt;br/&gt;</code>
</pre>
<pre><code>    &lt;/div&gt;</code>
</pre>
<pre><code>    &lt;div class='campo'&gt;</code>
</pre>
<pre><code>        &lt;label for='password' &gt;Contrase&ntilde;a:&lt;/label&gt;&lt;br/&gt;</code>
</pre>
<pre><code>        &lt;input type='password' name='password' id='password' maxlength="50" /&gt;&lt;br/&gt;</code>
</pre>
<pre><code>    &lt;/div&gt;</code>
</pre>
<pre><code>    &lt;div class='campo'&gt;</code>
</pre>
<pre><code>        &lt;input type='submit' name='enviar' value='Enviar' /&gt;</code>
</pre>
<pre><code>    &lt;/div&gt;</code>
</pre>
<pre><code>&lt;/fieldset&gt;</code>
</pre>
<pre><code>&lt;/form&gt;</code>
</pre>
<pre><code>&lt;/div&gt;</code>
</pre>
</div>
</div>
<p>F&iacute;jate que existe un espacio para poner los posibles mensajes de error que se produzcan, como la falta de alg&uacute;n dato necesario, o un error de credenciales err&oacute;neas.</p>
<p>El c&oacute;digo <span lang="en">PHP</span> que debe figurar al comienzo de esta misma p&aacute;gina (antes de que se muestre cualquier texto), se encargar&aacute; de:</p>
<p>Comprobar que se han introducido tanto el nombre de usuario como la contrase&ntilde;a.</p>
<div class="codigo elemento_centrado" style="width: 48.9em;">
<div class="texto_izquierda">
<pre><code>if (isset($_POST['enviar'])) {</code>
</pre>
<pre><code>        $usuario = $_POST['usuario'];</code>
</pre>
<pre><code>        $password = $_POST['password'];</code>
</pre>
<pre>&nbsp;</pre>
<pre><code>        if (empty($usuario) || empty($password)) </code>
</pre>
<pre><code>            $error = "Debes introducir un nombre de usuario y una contrase&ntilde;a";</code>
</pre>
<pre><code>        else {</code>
</pre>
</div>
</div>
<p>Conectarse a la base de datos.</p>
<div class="codigo elemento_centrado" style="width: 49.45em;">
<div class="texto_izquierda">
<pre><code>            try {</code>
</pre>
<pre><code>                $opc = array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; "SET NAMES utf8");</code>
</pre>
<pre><code>                $dsn = "mysql:host=localhost;dbname=dwes";</code>
</pre>
<pre><code>                $dwes = new PDO($dsn, "dwes", "abc123.", $opc);</code>
</pre>
<pre><code>            }</code>
</pre>
<pre><code>            catch (PDOException $e) {</code>
</pre>
<pre><code>                die("Error: " . $e-&gt;getMessage());</code>
</pre>
<pre><code>            }</code>
</pre>
</div>
</div>
<p>Comprobar las credenciales.</p>
<div class="codigo elemento_centrado" style="width: 41.75em;">
<div class="texto_izquierda">
<pre><code>$sql = "SELECT usuario FROM usuarios WHERE usuario='$usuario' " .</code>
</pre>
<pre><code>            "AND contrasena='" . md5($password) . "'";</code>
</pre>
<pre>&nbsp;</pre>
<pre><code>            if($resultado = $dwes-&gt;query($sql)) {</code>
</pre>
<pre><code>                $fila = $resultado-&gt;fetch();</code>
</pre>
<pre><code>                if ($fila != null) {</code>
</pre>
</div>
</div>
<p>Iniciar la sesi&oacute;n y almacenar en la variable de sesi&oacute;n <code>$_SESSION['usuario']</code> el nombre de usuario.</p>
<div class="codigo elemento_centrado" style="width: 22.5em;">
<div class="texto_izquierda">
<pre><code>session_start();</code>
</pre>
<pre><code>$_SESSION['usuario']=$usuario;</code>
</pre>
</div>
</div>
<p>Redirigir a la p&aacute;gina del listado de productos.</p>
<div class="codigo elemento_centrado" style="width: 35.7em;">
<div class="texto_izquierda">
<pre><code>header("Location: productos.php");                    </code>
</pre>
</div>
</div>
<p>Revisa el c&oacute;digo completo de la p&aacute;gina login.php y comprueba su funcionamiento antes de seguir con las dem&aacute;s.</p>
<div class="enlace_centrado"><a class="paquete" title="Descargar la p&aacute;gina de autentificaci&oacute;n para la aplicaci&oacute;n web de tienda online. [zip - 2.00 KB]" href="DWES04_CONT_R09b_login.zip">Login.php.</a> <span class="tamano"> (2.00 KB) </span></div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id43">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header" style="background-image:url(icon_autoevaluacionfpd.gif)"><h1 class="iDeviceTitle">Autoevaluación</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-43_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion43_60" class="block question iDevice_content">
<strong>En el código anterior, la sesión del usuario se inicia solo si proporciona un nombre de usuario y contraseña correctos. ¿Se podría haber iniciado la sesión al principio del código, aunque el usuario no proporcione credenciales?</strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i43_63" class="sr-av"><a href="#answer-43_63">Opción 1</a></label><input type="radio" name="option43_60" id="i43_63" class="exe-radio-option exe-radio-option-0-2-43_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-43_63"><div id="taans43_63" class="block iDevice_content">
No.

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i43_119" class="sr-av"><a href="#answer-43_119">Opción 2</a></label><input type="radio" name="option43_60" id="i43_119" class="exe-radio-option exe-radio-option-1-2-43_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-43_119"><div id="taans43_119" class="block iDevice_content">
Sí.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b43_60" class="feedback js-hidden">
<div id="taf43_63" class=" iDevice_content">
Recuerda lo que comentábamos anteriormente acerca de la sesión de los usuarios y la autentificación de los mismos.

</div>
</section>
<section id="sa1b43_60" class="feedback js-hidden">
<div id="taf43_119" class=" iDevice_content">
Sí, se puede iniciar la sesión de igual forma, aunque si el usuario no se autentifica no tendríamos ninguna información que incluir dentro de la misma.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-43_63">Incorrecto</a><span> (<a href="#sa0b43_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-43_119">Opción correcta</a><span> (<a href="#sa1b43_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="33_gestin_de_la_informacin_de_la_sesin_i.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="332_gestin_de_la_informacin_de_la_sesin_iii.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_fpd_js.js"></script></body></html>