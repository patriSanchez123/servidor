<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4.1.- Excepciones. | DWES02 </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Jesús Manuel Marín Navarro" />
<meta name="generator" content="eXeLearning 2.4.2 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-20"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">DWES02</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Trabajar con bases de datos en PHP.</a></li>
   <li><a href="1_acceso_a_bases_de_datos_desde_php.html" class="no-ch">1.- Acceso a bases de datos desde PHP.</a></li>
   <li><a href="2_mysql.html" class="daddy">2.- MySQL.</a>
   <ul class="other-section">
      <li><a href="21_instalacin_y_configuracin.html" class="no-ch">2.1.- Instalación y configuración.</a></li>
      <li><a href="22_herramientas_de_administracin.html" class="daddy">2.2.- Herramientas de administración.</a>
      <ul class="other-section">
         <li><a href="221_mysql_y_mysqladmin.html" class="no-ch">2.2.1.- mysql y mysqladmin.</a></li>
         <li><a href="222_phpmyadmin.html" class="no-ch">2.2.2.- phpMyAdmin.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="3_utilizacin_de_bases_de_datos_mysql_en_php.html" class="daddy">3.- Utilización de bases de datos MySQL en PHP.</a>
   <ul class="other-section">
      <li><a href="31_extensin_mysqli.html" class="daddy">3.1.- Extensión MySQLi.</a>
      <ul class="other-section">
         <li><a href="311_establecimiento_de_conexiones.html" class="no-ch">3.1.1.- Establecimiento de conexiones.</a></li>
         <li><a href="312_ejecucin_de_consultas.html" class="no-ch">3.1.2.- Ejecución de consultas.</a></li>
         <li><a href="313_transacciones.html" class="no-ch">3.1.3.- Transacciones.</a></li>
         <li><a href="314_obtencin_y_utilizacin_de_conjuntos_de_resultados.html" class="no-ch">3.1.4.- Obtención y utilización de conjuntos de resultados.</a></li>
         <li><a href="315_consultas_preparadas.html" class="no-ch">3.1.5.- Consultas preparadas.</a></li>
      </ul>
      </li>
      <li><a href="32_php_data_objects_pdo.html" class="daddy">3.2.- PHP Data Objects (PDO).</a>
      <ul class="other-section">
         <li><a href="321_establecimiento_de_conexiones.html" class="no-ch">3.2.1.- Establecimiento de conexiones.</a></li>
         <li><a href="322_ejecucin_de_consultas.html" class="no-ch">3.2.2.- Ejecución de consultas.</a></li>
         <li><a href="323_obtencin_y_utilizacin_de_conjuntos_de_resultados.html" class="no-ch">3.2.3.- Obtención y utilización de conjuntos de resultados.</a></li>
         <li><a href="324_consultas_preparadas.html" class="no-ch">3.2.4.- Consultas preparadas.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="4_errores_y_manejo_de_excepciones.html" class="current-page-parent daddy">4.- Errores y manejo de excepciones.</a>
   <ul>
      <li id="active"><a href="41_excepciones.html" class="active no-ch">4.1.- Excepciones.</a></li>
   </ul>
   </li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="4_errores_y_manejo_de_excepciones.html" class="prev"><span><span>&laquo; </span>Anterior</span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4.1.- Excepciones.</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id76">
<div class="iDevice emphasis0">
<div id="ta76_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado"><img src="DWES03_CONT_R19_Excepcion.png" alt="S&iacute;mbolos de media rueda dentada, uno de ellos con un s&iacute;mbolo de exclamaci&oacute;n." title="Excepci&oacute;n." height="160" width="164" /></div>
<div class="elemento_centrado credenciales"><a class="cc0" title="Dominio p&uacute;blico" href="http://creativecommons.org/publicdomain/zero/1.0/deed.es" target="_blank"><span class="transparente">Dominio p&uacute;blico</span></a>&nbsp;Elaboraci&oacute;n Propia</div>
</div>
<p>&nbsp;</p>
<p>A partir de la versi&oacute;n 5 se introdujo en PHP un modelo de excepciones similar al existente en otros lenguajes de programaci&oacute;n:</p>
<ul class="lista_verificacion">
<li>El c&oacute;digo susceptible de producir alg&uacute;n error se introduce en un bloque <strong>try</strong>.</li>
<li>Cuando se produce alg&uacute;n error, se lanza una excepci&oacute;n utilizando la instrucci&oacute;n <strong>throw</strong>.</li>
<li>Despu&eacute;s del bloque try debe haber como m&iacute;nimo un bloque <strong>catch</strong> encargado de procesar el error.</li>
<li>Si una vez acabado el bloque try no se ha lanzado ninguna excepci&oacute;n, se contin&uacute;a con la ejecuci&oacute;n en la l&iacute;nea siguiente al bloque o bloques catch.</li>
</ul>
<p>Por ejemplo, para lanzar una excepci&oacute;n cuando se produce una divisi&oacute;n por cero podr&iacute;as hacer:</p>
<div class="codigo elemento_centrado" style="width: 41.75em;">
<div class="texto_izquierda">
<pre><code>try {</code>
</pre>
<pre><code>    if ($divisor == 0)</code>
</pre>
<pre><code>        throw new Exception("Divisi&oacute;n por cero.");</code>
</pre>
<pre><code>    $resultado = $dividendo / $divisor;</code>
</pre>
<pre><code>}</code>
</pre>
<pre><code>catch (Exception $e) {</code>
</pre>
<pre><code>    echo "Se ha producido el siguiente error: ".$e-&gt;getMessage();</code>
</pre>
<pre><code>}</code>
</pre>
</div>
</div>
<p>&nbsp;</p>
<p>PHP ofrece una clase base <code><strong>Exception</strong></code> para utilizar como manejador de excepciones. Para lanzar una excepci&oacute;n no es necesario indicar ning&uacute;n par&aacute;metro, aunque de forma opcional se puede pasar un mensaje de error (como en el ejemplo anterior) y tambi&eacute;n un c&oacute;digo de error.<br /> Entre los m&eacute;todos que puedes usar con los objetos de la clase <code>Exception</code> est&aacute;n:</p>
<ul class="lista_verificacion">
<li><code><strong>getMessage</strong></code>. Devuelve el mensaje, en caso de que se haya puesto alguno.</li>
<li><strong>getCode</strong>. Devuelve el c&oacute;digo de error si existe.</li>
</ul>
<p>Las funciones internas de PHP y muchas extensiones como MySQLi usan el sistema de errores visto anteriormente. S&oacute;lo las extensiones m&aacute;s modernas orientadas a objetos, como es el caso de PDO, utilizan este modelo de excepciones. En este caso, lo m&aacute;s com&uacute;n es que la extensi&oacute;n defina sus propios manejadores de errores heredando de la clase <code>Exception</code> (veremos c&oacute;mo utilizar la herencia en una unidad posterior).</p>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id77">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Para saber más</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta77_47" class="block iDevice_content">
<p>
Utilizando la clase ErrorException es posible traducir los errores a excepciones.
</p>
<p class="enlace_centrado">
<a href="http://es.php.net/manual/es/class.errorexception.php" title="Acceder a información sobre la clase ErrorException en el manual de PHP." target="_self">Clase ErrorException</a>.
</p>

</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id78">
<div class="iDevice emphasis0">
<div id="ta78_73" class="block iDevice_content">
<p>
Concretamente, la clase <code>PDO</code>  permite definir la fórmula que usará cuando se produzca un error, utilizando el  atributo <strong>PDO::ATTR_ERRMODE</strong>. Las  posibilidades son:
</p>
<ul class="lista_verificacion">
	<li><strong>PDO::ERRMODE_SILENT</strong>.  No se hace nada cuando ocurre un error. Es el comportamiento por defecto.</li>
	<li><strong>PDO::ERRMODE_WARNING</strong>.  Genera un error de tipo E_WARNING cuando se produce un error.</li>
	<li><strong>PDO::ERRMODE_EXCEPTION</strong>.  Cuando se produce un error lanza una excepción utilizando el manejador propio <code><strong>PDOException</strong></code>. </li>
</ul>
<p>
Es decir, que si quieres utilizar  excepciones con la extensión <code>PDO</code>, debes configurar la conexión haciendo:
</p>
<div class="codigo elemento_centrado" style="width: 40.65em">
<div class="texto_izquierda">
<pre>
<code>$dwes-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</code>
</pre>
</div>
</div>
<br />
<p>
Por ejemplo, el siguiente código:
</p>
<div class="codigo elemento_centrado" style="width: 45.6em">
<div class="texto_izquierda">
<pre>
<code>$dwes = new PDO(&quot;mysql:host=localhost; dbname=dwes&quot;, &quot;dwes&quot;, &quot;abc123.&quot;);</code>
</pre>
<pre>
<code>$dwes-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</code>
</pre>
<pre>
<code>try {</code>
</pre>
<pre>
<code>    $sql = &quot;SELECT * FROM stox&quot;;</code>
</pre>
<pre>
<code>    $result = $dwes-&gt;query($sql);</code>
</pre>
<pre>
<code>    …</code>
</pre>
<pre>
<code>}</code>
</pre>
<pre>
<code>catch (PDOException $p) {</code>
</pre>
<pre>
<code>    echo &quot;Error &quot;.$p-&gt;getMessage().&quot;&lt;br /&gt;&quot;;</code>
</pre>
<pre>
<code>}</code>
</pre>
</div>
</div>
<br />
<p>
Captura la excepción que lanza PDO debido a que la tabla no existe. El bloque catch muestra el siguiente mensaje:
</p>
<div class="codigo elemento_centrado" style="width: 54.95em">
<div class="texto_izquierda">
<pre>
<code>Error SQLSTATE[42S02]: Base table or view not found: 1146 Table 'dwes.stox' doesn't exist</code>
</pre>
</div>
</div>
 

</div>
</div>
</article>
<article class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id79">
<div class="iDevice emphasis_ejercicioresueltofpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Ejercicio resuelto</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section id="ta79_67" class="block story iDevice_content">

</section>
<section id="taquesQuestion0b79" class="block iDevice_content">
<p>
Agrega control de excepciones para controlar los posibles errores de conexión que se puedan producir en el último ejercicio, mostrando en la parte inferior de la pantalla los errores que se produzcan.
</p>

</section>
<form name="feedback-form-quesFeedback0b79" action="#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b79text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b79" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler" /></p>
</div>
<section id="feedback-quesFeedback0b79" class="feedback js-feedback js-hidden">
<h1 class="js-sr-av">Retroalimentación</h1>
<p>
Revisa en la solución propuesta los cambios realizados para utilizar excepciones en el establecimiento de la conexión.
</p>
<div class="enlace_centrado">
 <a class="pdf" href="DWES03_CONT_R19b_Ejercicio_resuelto.pdf" title="Descargar solución al ejercicio de excepciones en la extensión PDO. [pdf - 0.01 MB]">Solución al ejercicio propuesto</a>. <span class="tamano"> (0.01 MB) </span> 
</div>
</section>
</form>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id80">
<div class="iDevice emphasis_autoevaluacionfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Autoevaluación</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<section class="question">
<form name="multi-choice-form-80_60" action="#" onsubmit="return false" class="activity-form">
<h1 class="js-sr-av">Pregunta</h1>
<div id="taquestion80_60" class="block question iDevice_content">
<strong>¿Cuántos bloques &quot;catch&quot; se han de utilizar después de un bloque &quot;try&quot;? </strong>

</div>
<section class="iDevice_answers">
<h1 class="js-sr-av">Respuestas</h1>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i80_63" class="sr-av"><a href="#answer-80_63">Opción 1</a></label><input type="radio" name="option80_60" id="i80_63" class="exe-radio-option exe-radio-option-0-2-80_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-80_63"><div id="taans80_63" class="block iDevice_content">
Uno. 

</div>
</div>
</section>
<section class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i80_75" class="sr-av"><a href="#answer-80_75">Opción 2</a></label><input type="radio" name="option80_60" id="i80_75" class="exe-radio-option exe-radio-option-1-2-80_60-multi"/>
</p>
<div class="iDevice_answer-content" id="answer-80_75"><div id="taans80_75" class="block iDevice_content">
Uno o más.

</div>
</div>
</section>
</section>
<section class="iDevice_feedbacks js-feedback">
<h1 class="js-sr-av">Retroalimentación</h1>
<section id="sa0b80_60" class="feedback js-hidden">
<div id="taf80_63" class=" iDevice_content">
Incorrecto, siempre debe haber al menos uno, pero ¿puede haber más?

</div>
</section>
<section id="sa1b80_60" class="feedback js-hidden">
<div id="taf80_75" class=" iDevice_content">
Efectivamente, debe haber como mínimo uno, pero puede haber más. En este caso se ejecutará el bloque &quot;catch&quot; cuyo manejador coincida que se ha lanzado mediante &quot;throw&quot;. Esto sólo tiene sentido si se utilizan distintos manejadores extendiendo el base que incluye PHP, &quot;Exception&quot;.

</div>
</section>
</section>
</form>
<section class="iDevice_solution feedback js-hidden">
<h1>Solución</h1>
<ol>
<li><a href="#answer-80_63">Incorrecto</a><span> (<a href="#sa0b80_60">Retroalimentación</a>)</span></li>
<li><a href="#answer-80_75">Opción correcta</a><span> (<a href="#sa1b80_60">Retroalimentación</a>)</span></li>
</ol>
</section>
</section>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper AppletIdevice" id="id90">
<div class="iDevice emphasis0" >
<div class="iDevice_content">
<div>
<object type="application/x-shockwave-flash" id="objlim" data="lim.swf?libro=extensiones_bbdd.lim" width="100%" height="100%" align="top" >
<param name="allowScriptAccess" value="always" />
<param name="movie" value="lim.swf?libro=extensiones_bbdd.lim"/>
<param name="quality" value="high" /> 
<param name="allowFullScreen" value="true" />
<param name="FlashVars" value="libro=extensiones_bbdd.lim"/>
<param name="src" value="lim.swf?libro=extensiones_bbdd.lim"/>
</object>
</div>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="4_errores_y_manejo_de_excepciones.html" class="prev"><span><span>&laquo; </span>Anterior</span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>